<!DOCTYPE html>
<html lang="fr">

  <head>

    <link rel="icon" href="img/logo_square.png">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="main.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"> </script>
    <script type="text/javascript" src="app.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-F5QY5F8S5L"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-F5QY5F8S5L');
    </script>

    <script>
    $(function(){
      $("#header").load("includes/header.html");
      $("#footer").load("includes/footer.html");
    });
    </script>

    <title>Up Close | Cinéma à Paris</title>

  </head>

  <script>
    var selected_date = new Date();
    var day = selected_date.getUTCDate();

    $(function() {
      document.getElementById("date_of_today").innerHTML = day_string(selected_date);

      $.getJSON('data/classic_movies.json', function(data) {
        $.ajaxSetup({cache:false});
        $.each(data.movies, function(i, f) {
          var movie = f.date;
          var md = new Date(movie[0], movie[1]-1, movie[2]);
          var mdStr = String(md.getFullYear()).concat('-', String(md.getMonth()+1), '-', String(md.getDate()));
          var sdStr = String(selected_date.getFullYear()).concat('-', String(selected_date.getMonth()+1), '-', String(selected_date.getDate()));
          var specified_hour = selected_date.getHours()-1;

          max_hour = display_real_dict(f.showtimes_theater, specified_hour)[0];
          new_dict = display_real_dict(f.showtimes_theater, specified_hour)[1];
          real_showtime = display_showtimes(new_dict);

          if (mdStr==sdStr && max_hour>=specified_hour){
            movie_page = f.title
            var tblRow = "<tr>" +
              "<td><b>" + movie_page + "</b> (" + f.directors + ", " + f.year + ")" + "</td>" +
              "<td>" + real_showtime + "</td>" +
              "</tr>"
            $(tblRow).appendTo("#userdata tbody");
          }
        });
      });
    });
  </script>

  <script>
    async function movies_after(specified_hour) {
      var tempScrollTop = $(window).scrollTop();
      await $('#userdata tbody').empty();
      $.getJSON('data/classic_movies.json', function(data) {
        $.ajaxSetup({cache:false});
        $.each(data.movies, function(i, f) {
          var movie = f.date ;
          var md = new Date(movie[0], movie[1]-1, movie[2])
          var mdStr = String(md.getFullYear()).concat('-', String(md.getMonth()+1), '-', String(md.getDate()))
          var sdStr = String(selected_date.getFullYear()).concat('-', String(selected_date.getMonth()+1), '-', String(selected_date.getDate()))

          var nd = new Date();
          var start = new Date(nd.getFullYear(), 0, 0);
          var num_day_today = Math.floor((nd - start) / (1000 * 60 * 60 * 24));
          var num_day_selected = Math.floor((selected_date - start) / (1000 * 60 * 60 * 24));

          if (num_day_selected == num_day_today){
            var day_hour = nd.getHours()-1;
          }
          else{
            var day_hour = 0;
          }
          hour_constraint = Math.max(specified_hour, day_hour);
          console.log(hour_constraint)
          max_hour = display_real_dict(f.showtimes_theater, hour_constraint)[0];
          new_dict = display_real_dict(f.showtimes_theater, hour_constraint)[1];
          real_showtime = display_showtimes(new_dict);

          if (mdStr==sdStr && max_hour>=hour_constraint){
            var tblRow = "<tr>" +
              "<td><b>" + f.title + "</b> (" + f.directors + ", " + f.year + ")" + "</td>" +
              "<td>" + real_showtime + "</td>" +
              "</tr>"
            $(tblRow).appendTo("#userdata tbody");
          }
        });
      });
      $(window).scrollTop(tempScrollTop);
    }
  </script>

  <script>
    async function move_date_forward() {
      document.getElementById("backward_button").style.color = "var(--red)";
      Checkbox19.checked = 0
      var tempScrollTop = $(window).scrollTop();
      selected_date.setDate(selected_date.getDate()+1);
      document.getElementById("date_of_today").innerHTML = day_string(selected_date);

      await $('#userdata tbody').empty();
      $.getJSON('data/classic_movies.json', function(data) {
        $.ajaxSetup({cache:false});
        $.each(data.movies, function(i, f) {
          var movie = f.date;
          var md = new Date(movie[0], movie[1]-1, movie[2]);
          var mdStr = String(md.getFullYear()).concat('-', String(md.getMonth()+1), '-', String(md.getDate()));
          var sdStr = String(selected_date.getFullYear()).concat('-', String(selected_date.getMonth()+1), '-', String(selected_date.getDate()));
          var specified_hour = 0;

          max_hour = display_real_dict(f.showtimes_theater, specified_hour)[0];
          new_dict = display_real_dict(f.showtimes_theater, specified_hour)[1];
          real_showtime = display_showtimes(new_dict);

          if (mdStr==sdStr && max_hour>=specified_hour){
            var tblRow = "<tr>" +
              "<td><b>" + f.title + "</b> (" + f.directors + ", " + f.year + ")" + "</td>" +
              "<td>" + real_showtime + "</td>" +
              "</tr>"
            $(tblRow).appendTo("#userdata tbody");
          }
        });
      });
      $(window).scrollTop(tempScrollTop);
    }
  </script>

  <script>
    function move_date_backward() {
      Checkbox19.checked = 0;
      var nd = new Date();
      var start = new Date(nd.getFullYear(), 0, 0);
      var num_day_today = Math.floor((nd - start) / (1000 * 60 * 60 * 24));
      var num_day_selected = Math.floor((selected_date-1 - start) / (1000 * 60 * 60 * 24));

      if (num_day_selected-1 <= num_day_today){
        document.getElementById("backward_button").style.color = "var(--lightgrey)";
      }
      else{
        document.getElementById("backward_button").style.color = "var(--red)";
      }
      if (num_day_selected > num_day_today){
          var tempScrollTop = $(window).scrollTop();
          selected_date.setDate(selected_date.getDate()-1);
          document.getElementById("date_of_today").innerHTML = day_string(selected_date);

          $('#userdata tbody').empty();
          $.getJSON('data/classic_movies.json', function(data) {
            $.ajaxSetup({cache:false});
            $.each(data.movies, function(i, f) {

              var movie = f.date;
              var md = new Date(movie[0], movie[1]-1, movie[2]);
              var mdStr = String(md.getFullYear()).concat('-', String(md.getMonth()+1), '-', String(md.getDate()));
              var sdStr = String(selected_date.getFullYear()).concat('-', String(selected_date.getMonth()+1), '-', String(selected_date.getDate()));
              var today = new Date();
              var todayStr = String(today.getFullYear()).concat('-', String(today.getMonth()+1), '-', String(today.getDate()));

              if (todayStr==sdStr){
                var specified_hour = today.getHours()-1;
              }
              else {
                var specified_hour = 0;
              }
              max_hour = display_real_dict(f.showtimes_theater, specified_hour)[0];
              new_dict = display_real_dict(f.showtimes_theater, specified_hour)[1];
              real_showtime = display_showtimes(new_dict);
              if (mdStr==sdStr && max_hour>=specified_hour){
                  var tblRow = "<tr>" +
                    "<td><b>" + f.title + "</b> (" + f.directors + ", " + f.year + ")" + "</td>" +
                    "<td>" + real_showtime + "</td>" +
                    "</tr>"
                  $(tblRow).appendTo("#userdata tbody");
              }
            });
          });
          $(window).scrollTop(tempScrollTop);
      }
    }
  </script>

  <body class="light-theme">

    <div id="header"></div>

    <center>
      <input type="button" id="backward_button" class="button" value= "◀&#xFE0E;" onclick="move_date_backward()" style="color: var(--lightgrey);">
      <b><span id="date_of_today" class="center"></span></b>
      <input type="button" class="button" value= "▶&#xFE0E;" onclick="move_date_forward()" style="color: var(--red);">
    </center>
    <br>

    <center>
      <input type="checkbox" name="19_movies" id= "19_movies" name="19_movies" style="font-size: var(--button_font_size);">
      <label for="subscribeNews">Séances après 19h</label>
    </center>
    <br>

    <script>
      var Checkbox19 = document.querySelector('input[name="19_movies"]');
      Checkbox19.onchange = function() {
        if(Checkbox19.checked) {
          movies_after(19)
        } else {
          movies_after(0)
        }
      };
    </script>

    <div class="wrapper">
    <div class="profile">
      <table id= "userdata" border="2" class="center">
      <thead>
        <th style="width:50%;background-color:var(--red);color:var(--white);">Film</th>
        <th style="width:50%;background-color:var(--red);color:var(--white);">Séances</th>
      </thead>
      <tbody>
      </tbody>
      </table>
    </div>
    </div>

    <div id="footer"></div>
  </body>
</html>
